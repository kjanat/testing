name: Matrix Two
on: { workflow_dispatch: {} }
jobs:
  buildtwo:
    name: Build Two (${{ matrix.arch }}-${{ matrix.env }})
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        arch: [x86_64, aarch64]
        env:
          - unknown-linux-gnu
          - unknown-linux-musl
          - apple-darwin
          - pc-windows-msvc
        include:
          # Map env -> OS (flat, no nested objects)
          - { env: unknown-linux-gnu, os: ubuntu-latest }
          - { env: unknown-linux-musl, os: ubuntu-latest }
          - { env: apple-darwin, os: macos-latest }
          - { env: pc-windows-msvc, os: windows-latest, archive: zip }
          # Cross only for Linux aarch64
          - { arch: aarch64, env: unknown-linux-gnu, cross: true }
          - { arch: aarch64, env: unknown-linux-musl, cross: true }
        exclude: # Prevent nonsense combos
          - { env: apple-darwin, arch: x86_64 } # remove if you *do* want intel mac builds
          # If you *do* want both mac arches, delete the above line.
    env:
      TARGET: ${{ matrix.arch }}-${{ matrix.env }}
      ARCHIVE: ${{ matrix.archive || 'tar.gz' }}
      CROSS: ${{ matrix.cross || 'false' }}
    steps:
      - uses: actions/github-script@v8
        with:
          script: |
            const messages = [];
            messages.push(`Running on OS: ${process.env.RUNNER_OS}`);
            messages.push(`Building target: ${process.env.TARGET}`);
            messages.push(`Using archive format: ${process.env.ARCHIVE}`);
            messages.push(`Cross-compiling: ${process.env.CROSS}`);
            for (const msg of messages) {
              core.notice(msg);
              core.summary.addRaw(`${msg}  \n`);
              core.setOutput(msg.replace(/ /g, '_').toLowerCase(), true);
            }
